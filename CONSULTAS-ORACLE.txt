-- CONSULTAS - ORACLE

/* Consulta arquivo que foi enviado para análise bancária */
SELECT
  acp.*
FROM FIES_FINANCIAMENTO.TB_FIN_ARQ_CANDIDATO_PRIV acp
  JOIN FIES_FINANCIAMENTO.TH_FIN_ARQ_CANDIDATO_PRIV hacp
    ON hacp.CO_ARQ_CANDIDATO_PRIV = acp.CO_ARQ_CANDIDATO_PRIV
  JOIN FIES_FINANCIAMENTO.TB_FIN_LOTE_PROC_CAND_PRIV lote
    ON lote.CO_LOTE_PROC_CAND_PRIV = acp.CO_LOTE_PROC_CAND_PRIV
WHERE
  1 = 1
  AND acp.TP_ARQ_CANDIDATO_PRIV = 1
  AND hacp.TP_H_ARQ_CANDIDATO_PRIV = 1
  AND lote.ST_LOTE_LIBERADO = 'S'
  AND TO_CHAR(hacp.DT_H_ARQ_CANDIDATO_PRIV, 'YYYY/MM/DD') > '2019/02/01'
  AND acp.TX_CONTEUDO_ARQ LIKE '%08664995478%';


/* Consulta arquivo que foi retornado da análise bancária */
SELECT
  b.CO_BANCO,
  b.NO_BANCO,
  acp.TX_CONTEUDO_ARQ,
  proc.ST_PROC_CANDIDATO_PRIV,
  proc.CO_INSCRICAO,
  ret.*
FROM FIES_FINANCIAMENTO.TB_FIN_ARQ_CANDIDATO_PRIV acp
  JOIN FIES_FINANCIAMENTO.TH_FIN_ARQ_CANDIDATO_PRIV hacp
    ON hacp.CO_ARQ_CANDIDATO_PRIV = acp.CO_ARQ_CANDIDATO_PRIV
  JOIN FIES_GLOBAL.TB_GLB_BANCO b
    ON b.DS_TOKEN = acp.DS_TOKEN
  JOIN FIES_FINANCIAMENTO.TB_FIN_PROC_ARQ_CAND_PRIV proc
    ON proc.CO_ARQ_CANDIDATO_PRIV = acp.CO_ARQ_CANDIDATO_PRIV
  LEFT JOIN FIES_FINANCIAMENTO.TB_FIN_PROC_ARQ_CAND_PRIV_RET ret
    ON ret.CO_PROC_ARQ_CAND_PRIV = proc.CO_PROC_ARQ_CAND_PRIV
WHERE
  1 = 1
  AND acp.TP_ARQ_CANDIDATO_PRIV = 2
  AND hacp.TP_H_ARQ_CANDIDATO_PRIV = 3
  AND hacp.TP_H_ARQ_CANDIDATO_PRIV = 3
  AND (CO_INSCRICAO = 90523509 or DS_PROCESSAMENTO like '%90523509%');​